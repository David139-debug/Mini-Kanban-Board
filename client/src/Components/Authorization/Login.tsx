import { useState } from "react"
import logo from "./img/Logomark.svg"
import { useForm } from "react-hook-form";
import { yupResolver } from "@hookform/resolvers/yup";
import * as yup from "yup";
import { useDispatch } from "react-redux";
import { loginUser } from "../../Redux/authSlice";
import { type AppDispatch } from "../../Redux/store";
import { unwrapResult } from "@reduxjs/toolkit";
import { useNavigate } from "react-router-dom";

interface FormState {
    email: string;
    password: string;
}

const schema: yup.ObjectSchema<FormState> = yup.object({
    email: yup
        .string()
        .required("Field is empty.")
        .email("Invalid email format."),

    password: yup
        .string()
        .required("Field is empty.")
        .min(3, "You must enter at least 3 characters in field."),
});

const Login = () => {

    const dispatch = useDispatch<AppDispatch>();
    const navigate = useNavigate();

    const [showPassword, setShowPassword] = useState<boolean>(false);

    const {
        register,
        handleSubmit,
        setError,
        formState: { errors }
    } = useForm<FormState>({
        resolver: yupResolver(schema)
    })

    const onSubmit = async (data: FormState) => {
        try {
            const actionResult = await dispatch(loginUser(data));
            unwrapResult(actionResult);
            navigate("/settings");
        } catch (err) {
            if (err) {
                setError("password", {
                    type: "manual",
                    message: "Correct data."
                })
            }
        }
    };

  return (
      <section className="flex h-screen items-center justify-center py-16 px-4">
        <article className="flex flex-col gap-8">
            <div className="flex flex-col gap-6">
                  <div className="flex items-center gap-2 justify-center">
                    <img src={logo} alt="logo" />
                    <svg xmlns="http://www.w3.org/2000/svg" width="70" height="17" viewBox="0 0 70 17" fill="none">
                        <path d="M6.1431 17C4.77231 17 3.57667 16.6905 2.55619 16.0715C1.55094 15.4378 0.865545 14.5904 0.5 13.5293L3.01312 12.3797C3.33297 13.0282 3.76706 13.5366 4.31538 13.9051C4.86369 14.2735 5.47293 14.4577 6.1431 14.4577C6.63049 14.4577 7.00365 14.3619 7.26258 14.1704C7.52151 13.9788 7.65097 13.7135 7.65097 13.3745C7.65097 13.1977 7.60528 13.0503 7.51389 12.9324C7.42251 12.7997 7.28543 12.6818 7.10266 12.5787C6.91988 12.4755 6.69142 12.3871 6.41726 12.3134L4.29253 11.7386C3.27205 11.4586 2.48765 11.0091 1.93933 10.3901C1.39102 9.75639 1.11686 9.01214 1.11686 8.15735C1.11686 7.40572 1.31486 6.74989 1.71087 6.18986C2.10687 5.62982 2.66281 5.19506 3.37867 4.88557C4.09453 4.56134 4.917 4.39922 5.8461 4.39922C7.06458 4.39922 8.13075 4.67924 9.04461 5.23927C9.97371 5.78457 10.6286 6.5583 11.0094 7.56047L8.47345 8.71001C8.29068 8.20893 7.95559 7.81101 7.4682 7.51625C6.99604 7.20676 6.45534 7.05202 5.8461 7.05202C5.4044 7.05202 5.05408 7.14044 4.79515 7.31729C4.55146 7.49415 4.42961 7.73732 4.42961 8.04681C4.42961 8.20893 4.4753 8.35631 4.56669 8.48895C4.65807 8.62159 4.80277 8.73949 5.00077 8.84265C5.21401 8.94582 5.47293 9.04161 5.77756 9.13004L7.76521 9.70481C8.80092 9.99957 9.59293 10.4491 10.1412 11.0533C10.6896 11.6428 10.9637 12.3723 10.9637 13.2419C10.9637 13.9935 10.7581 14.6493 10.3469 15.2094C9.95086 15.7694 9.39493 16.2115 8.67907 16.5358C7.96321 16.8453 7.11789 17 6.1431 17Z" fill="#1E293B" />
                        <path d="M16.5074 16.8674C14.9843 16.8674 13.8648 16.5505 13.149 15.9168C12.4483 15.2683 12.098 14.2588 12.098 12.8882V0H15.525V12.645C15.525 13.544 16.0276 13.9935 17.0329 13.9935H17.1243V16.8674H16.5074Z" fill="#1E293B" />
                        <path d="M24.292 17C23.0583 17 21.9312 16.7274 20.9107 16.1821C19.9055 15.6368 19.0982 14.8925 18.489 13.9493C17.895 12.9913 17.598 11.9081 17.598 10.6996C17.598 9.47638 17.895 8.39315 18.489 7.44994C19.0982 6.50672 19.9055 5.76246 20.9107 5.21716C21.9312 4.67187 23.0583 4.39922 24.292 4.39922C25.5257 4.39922 26.6452 4.67187 27.6505 5.21716C28.6557 5.76246 29.4553 6.50672 30.0493 7.44994C30.6586 8.39315 30.9632 9.47638 30.9632 10.6996C30.9632 11.9081 30.6586 12.9913 30.0493 13.9493C29.4553 14.8925 28.6557 15.6368 27.6505 16.1821C26.6452 16.7274 25.5257 17 24.292 17ZM24.292 14.0156C24.9165 14.0156 25.4572 13.8756 25.9141 13.5956C26.3863 13.3156 26.7518 12.925 27.0108 12.4239C27.2849 11.9228 27.422 11.3481 27.422 10.6996C27.422 10.0511 27.2849 9.48374 27.0108 8.9974C26.7518 8.49632 26.3863 8.10576 25.9141 7.82575C25.4572 7.53099 24.9165 7.38362 24.292 7.38362C23.6675 7.38362 23.1192 7.53099 22.6471 7.82575C22.1749 8.10576 21.8017 8.49632 21.5276 8.9974C21.2687 9.48374 21.1392 10.0511 21.1392 10.6996C21.1392 11.3481 21.2687 11.9228 21.5276 12.4239C21.8017 12.925 22.1749 13.3156 22.6471 13.5956C23.1192 13.8756 23.6675 14.0156 24.292 14.0156Z" fill="#1E293B" />
                        <path d="M37.8538 16.8674C36.3459 16.8674 35.1731 16.4768 34.3354 15.6957C33.5129 14.8999 33.1017 13.7945 33.1017 12.3797V7.53836H30.9998V4.6645H31.114C31.7537 4.6645 32.2411 4.50975 32.5762 4.20026C32.9265 3.89077 33.1017 3.42653 33.1017 2.80754V1.92328H36.5287V4.6645H39.453V7.53836H36.5287V12.1586C36.5287 12.5713 36.6048 12.9176 36.7571 13.1977C36.9094 13.4629 37.1455 13.6619 37.4654 13.7945C37.7852 13.9272 38.1812 13.9935 38.6534 13.9935C38.76 13.9935 38.8819 13.9861 39.0189 13.9714C39.156 13.9567 39.3007 13.9419 39.453 13.9272V16.7347C39.2246 16.7642 38.9656 16.7937 38.6762 16.8231C38.3869 16.8526 38.1127 16.8674 37.8538 16.8674Z" fill="#1E293B" />
                        <path d="M40.5473 16.7347V0H43.9743V4.6645H46.4646C47.6069 4.6645 48.5893 4.85609 49.4118 5.23927C50.2343 5.62245 50.8664 6.16775 51.3081 6.87516C51.7498 7.58257 51.9706 8.42263 51.9706 9.39532V16.7347H48.5436V9.57217C48.5436 8.95319 48.3533 8.45947 47.9725 8.09103C47.5917 7.72258 47.0891 7.53836 46.4646 7.53836H43.9743V16.7347H40.5473Z" fill="#1E293B" />
                        <path d="M58.7705 17C57.6282 17 56.6305 16.7863 55.7776 16.3589C54.9247 15.9315 54.2545 15.3346 53.7671 14.5683C53.2949 13.8019 53.0589 12.9103 53.0589 11.8934V4.6645H56.4859V11.827C56.4859 12.2692 56.5772 12.6524 56.76 12.9766C56.958 13.3008 57.2322 13.5587 57.5825 13.7503C57.9328 13.9272 58.3288 14.0156 58.7705 14.0156C59.2274 14.0156 59.6234 13.9272 59.9585 13.7503C60.3088 13.5587 60.5754 13.3008 60.7582 12.9766C60.9562 12.6524 61.0552 12.2692 61.0552 11.827V4.6645H64.4821V11.8934C64.4821 12.9103 64.2385 13.8019 63.7511 14.5683C63.2789 15.3346 62.6163 15.9315 61.7634 16.3589C60.9105 16.7863 59.9128 17 58.7705 17Z" fill="#1E293B" />
                        <path d="M66.073 16.7347V4.6645H69.5V16.7347H66.073ZM66.073 3.58127V0.265279H69.5V3.58127H66.073Z" fill="#1E293B" />
                    </svg>
                </div>
                <div className="flex flex-col items-center gap-2 text-center">
                    <h1 className="text-4xl font-bold">Sign In To Your Account.</h1>
                    <h1 className="text-lg text-[#475569]">Unleash your inner sloth 4.0 right now.</h1>
                </div>
            </div>

            <form onSubmit={handleSubmit(onSubmit)} className="flex flex-col gap-6">
                <div className="flex flex-col gap-2">
                      <label className="text-[#1E293B] font-bold text-sm">Email Address</label>
                      <div className="flex items-center gap-4 border border-[#CBD5E1] rounded-full p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                            <path d="M17.5 3.9375H2.5C2.25136 3.9375 2.0129 4.03627 1.83709 4.21209C1.66127 4.3879 1.5625 4.62636 1.5625 4.875V15.5C1.5625 15.9144 1.72712 16.3118 2.02015 16.6049C2.31317 16.8979 2.7106 17.0625 3.125 17.0625H16.875C17.2894 17.0625 17.6868 16.8979 17.9799 16.6049C18.2729 16.3118 18.4375 15.9144 18.4375 15.5V4.875C18.4375 4.62636 18.3387 4.3879 18.1629 4.21209C17.9871 4.03627 17.7486 3.9375 17.5 3.9375ZM15.0898 5.8125L10 10.4781L4.91016 5.8125H15.0898ZM3.4375 15.1875V7.00625L9.36641 12.4414C9.53932 12.6 9.7654 12.6879 10 12.6879C10.2346 12.6879 10.4607 12.6 10.6336 12.4414L16.5625 7.00625V15.1875H3.4375Z" fill="#475569" />
                        </svg>
                          <input { ...register("email") } type="email" placeholder="Enter Email" className="flex-grow outline-none text-[#475569] placeholder:text-[#475569]" />
                    </div>
                      {errors.email && <span className="font-bold text-red-500 text-sm">{errors.email.message}</span>}
                </div>

                <div className="flex flex-col gap-3">
                    <div className="flex flex-col gap-2">
                        <label className="text-[#1E293B] font-bold text-sm">Password</label>
                        <div className="flex items-center gap-4 border border-[#CBD5E1] rounded-full p-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                                <path d="M16.25 6.4375H14.0625V4.875C14.0625 3.79756 13.6345 2.76425 12.8726 2.00238C12.1108 1.24051 11.0774 0.8125 10 0.8125C8.92256 0.8125 7.88925 1.24051 7.12738 2.00238C6.36551 2.76425 5.9375 3.79756 5.9375 4.875V6.4375H3.75C3.3356 6.4375 2.93817 6.60212 2.64515 6.89515C2.35212 7.18817 2.1875 7.5856 2.1875 8V16.75C2.1875 17.1644 2.35212 17.5618 2.64515 17.8549C2.93817 18.1479 3.3356 18.3125 3.75 18.3125H16.25C16.6644 18.3125 17.0618 18.1479 17.3549 17.8549C17.6479 17.5618 17.8125 17.1644 17.8125 16.75V8C17.8125 7.5856 17.6479 7.18817 17.3549 6.89515C17.0618 6.60212 16.6644 6.4375 16.25 6.4375ZM7.8125 4.875C7.8125 4.29484 8.04297 3.73844 8.4532 3.3282C8.86344 2.91797 9.41984 2.6875 10 2.6875C10.5802 2.6875 11.1366 2.91797 11.5468 3.3282C11.957 3.73844 12.1875 4.29484 12.1875 4.875V6.4375H7.8125V4.875ZM15.9375 16.4375H4.0625V8.3125H15.9375V16.4375Z" fill="#475569" />
                            </svg>
                              <input {...register("password")} type={showPassword ? "text" : "password"} placeholder="Enter Password" className="flex-grow outline-none text-[#475569] placeholder:text-[#475569]" />
                            <svg className="cursor-pointer" onClick={() => setShowPassword(prev => !prev)} xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                                <path d="M4.44375 2.99455C4.36142 2.90174 4.26149 2.8262 4.14975 2.7723C4.03801 2.7184 3.91669 2.68722 3.7928 2.68055C3.66892 2.67389 3.54495 2.69188 3.42807 2.73348C3.3112 2.77508 3.20374 2.83946 3.11193 2.9229C3.02012 3.00634 2.94578 3.10716 2.89322 3.21954C2.84067 3.33192 2.81094 3.45361 2.80576 3.57756C2.80058 3.70152 2.82005 3.82526 2.86305 3.94163C2.90605 4.058 2.97172 4.16468 3.05625 4.25549L4.30625 5.63439C1.61485 7.42658 0.446877 9.99846 0.390627 10.1195C0.337699 10.2395 0.310364 10.3693 0.310364 10.5004C0.310364 10.6316 0.337699 10.7613 0.390627 10.8813C0.419533 10.9453 1.10391 12.4641 2.61641 13.9758C4.63828 15.9953 7.1875 17.0625 10 17.0625C11.3669 17.0701 12.7215 16.8045 13.9844 16.2813L15.5539 18.0078C15.722 18.1884 15.9545 18.2954 16.201 18.3057C16.4474 18.316 16.688 18.2288 16.8706 18.0628C17.0532 17.8969 17.163 17.6657 17.1762 17.4194C17.1895 17.1731 17.1051 16.9314 16.9414 16.7469L4.44375 2.99455ZM10 15.1875C7.68828 15.1875 5.66641 14.3492 3.99141 12.6969C3.33254 12.0445 2.76561 11.3054 2.30625 10.5C2.71797 9.77267 3.77422 8.16408 5.5875 7.03986L12.6258 14.7828C11.777 15.0539 10.891 15.1904 10 15.1875ZM19.6094 10.8813C19.5813 10.9445 18.9063 12.4438 17.4219 13.9406C17.3369 14.035 17.2336 14.1111 17.1183 14.1643C17.003 14.2175 16.8781 14.2468 16.7511 14.2503C16.6242 14.2538 16.4979 14.2315 16.3798 14.1847C16.2618 14.1378 16.1545 14.0675 16.0644 13.978C15.9743 13.8885 15.9034 13.7816 15.8559 13.6638C15.8084 13.546 15.7853 13.4198 15.7881 13.2929C15.7908 13.1659 15.8193 13.0408 15.8719 12.9252C15.9244 12.8096 15.9999 12.7059 16.0938 12.6203C16.7173 11.9864 17.2552 11.2735 17.6938 10.5C17.2347 9.69443 16.6677 8.95531 16.0086 8.30314C14.3328 6.6508 12.3117 5.81252 10 5.81252C9.73828 5.81252 9.47656 5.82346 9.21875 5.84533C9.09451 5.85864 8.96887 5.84698 8.8492 5.81104C8.72953 5.77509 8.61825 5.71559 8.52191 5.63602C8.42557 5.55646 8.3461 5.45844 8.28818 5.34772C8.23027 5.237 8.19507 5.11583 8.18465 4.99131C8.17423 4.8668 8.18882 4.74145 8.22753 4.62265C8.26625 4.50385 8.32833 4.39399 8.41012 4.29953C8.4919 4.20506 8.59175 4.1279 8.70378 4.07257C8.81581 4.01725 8.93778 3.98488 9.0625 3.97736C9.36953 3.9508 9.6875 3.93752 10 3.93752C12.8125 3.93752 15.3617 5.00549 17.382 7.02502C18.8938 8.53674 19.5781 10.0563 19.607 10.1195C19.6603 10.2394 19.6881 10.369 19.6885 10.5002C19.6889 10.6313 19.6619 10.7611 19.6094 10.8813Z" fill="#CBD5E1" />
                            </svg>
                        </div>
                          {errors.password && <span className="font-bold text-red-500 text-sm">{errors.password.message}</span>}
                    </div>
                      <button className="bg-[#4F46E5] hover:bg-[hsl(243,75%,53%)] cursor-pointer duration-100 text-white py-3 px-5 rounded-full items-center gap-2.5 font-bold border flex text-center justify-center">
                        Sign In
                        <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 21 21" fill="none">
                            <path d="M10.1875 17.375C10.1875 17.6236 10.0887 17.8621 9.91291 18.0379C9.7371 18.2137 9.49864 18.3125 9.25 18.3125H4.25C4.00136 18.3125 3.7629 18.2137 3.58709 18.0379C3.41127 17.8621 3.3125 17.6236 3.3125 17.375V3.625C3.3125 3.37636 3.41127 3.1379 3.58709 2.96209C3.7629 2.78627 4.00136 2.6875 4.25 2.6875H9.25C9.49864 2.6875 9.7371 2.78627 9.91291 2.96209C10.0887 3.1379 10.1875 3.37636 10.1875 3.625C10.1875 3.87364 10.0887 4.1121 9.91291 4.28791C9.7371 4.46373 9.49864 4.5625 9.25 4.5625H5.1875V16.4375H9.25C9.49864 16.4375 9.7371 16.5363 9.91291 16.7121C10.0887 16.8879 10.1875 17.1264 10.1875 17.375ZM18.6633 9.83672L15.5383 6.71172C15.3622 6.5356 15.1233 6.43665 14.8742 6.43665C14.6251 6.43665 14.3863 6.5356 14.2102 6.71172C14.034 6.88784 13.9351 7.12671 13.9351 7.37578C13.9351 7.62485 14.034 7.86372 14.2102 8.03984L15.7344 9.5625H9.25C9.00136 9.5625 8.7629 9.66127 8.58709 9.83709C8.41127 10.0129 8.3125 10.2514 8.3125 10.5C8.3125 10.7486 8.41127 10.9871 8.58709 11.1629C8.7629 11.3387 9.00136 11.4375 9.25 11.4375H15.7344L14.2094 12.9617C14.0333 13.1378 13.9343 13.3767 13.9343 13.6258C13.9343 13.8749 14.0333 14.1137 14.2094 14.2898C14.3855 14.466 14.6244 14.5649 14.8734 14.5649C15.1225 14.5649 15.3614 14.466 15.5375 14.2898L18.6625 11.1648C18.7499 11.0778 18.8194 10.9743 18.8667 10.8604C18.9141 10.7465 18.9386 10.6243 18.9386 10.5009C18.9387 10.3776 18.9144 10.2554 18.8672 10.1414C18.8199 10.0274 18.7506 9.92387 18.6633 9.83672Z" fill="white" />
                        </svg>
                    </button>
                </div>
                <div className="flex gap-1 justify-center">
                      <p className="font-bold text-[#1E293B]">Donâ€™t have an account?</p>
                      <a href="/register" className="text-[#4F46E5] font-bold">Sign Up</a>
                </div>
                  <p className="text-center font-bold text-sm text-[#4F46E5]">Forgot Password</p>
            </form>
        </article>
    </section>
  )
}

export default Login